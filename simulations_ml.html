<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="canonical" href="https://neuropsis.org/simulations_ml.html">
    <meta name="description" content="Overview of my work in neural data simulation and machine learning.">
    <title>Simulation and Machine Learning | Remy Cohan</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        /* --- MAIN SITE STYLES --- */
        body {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            padding: 0;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #f7f9fc, #dfe6e9);
        }

        header.logo-header {
            height: 150px; /* fixed, elegant, no jumping */
            
            background-image: url("images/Logo_small.png");
            background-size: cover;        /* fills width cleanly */
            background-position: center 47%;   /* logo stays centred */
            background-repeat: no-repeat;
        
            box-shadow: 0px 3px 10px rgba(0, 0, 0, 0.18);
        }


        nav {
            display: flex;
            justify-content: center;
            gap: 20px;
            padding: 10px 0;
            background-color: #000;
            box-shadow: none;
        }
        
        nav a {
            color: #fff;
            text-decoration: none;
            padding: 10px 20px;
            font-weight: 500;
        }
        
        nav a:hover {
            color: #d0d0d0;
        }

        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            height: 100%;
            width: 0;
            overflow: hidden;
            background-color: #34495e;
            padding: 20px 0;
            box-shadow: 2px 0px 5px rgba(0, 0, 0, 0.1);
            transition: width 0.5s ease;
            z-index: 1001;
        }

        .sidebar:hover,
        .sidebar:focus {
            width: 250px;
        }

        .sidebar h3,
        .sidebar a {
            color: white;
            margin-left: 20px;
            text-decoration: none;
            display: block;
            margin-bottom: 20px;
            transition: color 0.3s;
        }

        .sidebar a:hover {
            color: #bdc3c7;
        }

        .sidebar-tab {
            position: fixed;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            background-color: #34495e;
            color: white;
            padding: 10px;
            border-top-right-radius: 5px;
            border-bottom-right-radius: 5px;
            cursor: pointer;
            z-index: 1000;
            transition: background-color 0.3s;
        }

        main {
            margin-left: 0;
            padding: 40px;
            background-color: #ffffff;
            box-shadow: 0px 3px 15px rgba(0, 0, 0, 0.1);
            border-radius: 10px;
            max-width: 1200px;
            margin: 20px auto;
        }

        /* --- SIMULATION STYLES --- */
        .explanation-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            background: #f0f7fb;
            border-left: 5px solid #2E86C1;
            padding: 20px;
            border-radius: 5px;
            margin-bottom: 30px;
            font-size: 0.9em;
        }
        .exp-col h4 { margin-top: 0; color: #2E86C1; margin-bottom: 8px; }
        .exp-col ul { margin: 0; padding-left: 20px; }
        .exp-col li { margin-bottom: 5px; }

        .sim-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
            width: 100%;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #e1e4e8;
            margin-bottom: 40px;
            box-sizing: border-box;
        }

        .canvas-wrapper {
            background: white;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            position: relative;
            flex: 1 1 500px;
        }
        
        canvas {
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: #fff;
            width: 100%;
            height: 350px;
        }

        .controls {
            flex: 1 1 300px;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }

        .control-group { margin-bottom: 15px; }
        .control-group h3 { 
            margin: 0 0 10px 0; 
            font-size: 1em; 
            border-bottom: 2px solid #eee; 
            padding-bottom: 5px; 
            color: #555;
        }
        
        .slider-container {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }
        .slider-label { flex: 2; font-size: 0.85em; font-weight: 500;}
        input[type=range] { flex: 3; margin: 0 10px; cursor: pointer; }
        .slider-value { flex: 1; text-align: right; font-family: monospace; font-size: 0.85em; color: #555; }

        .preset-btn {
            padding: 6px 12px;
            margin-right: 5px;
            margin-bottom: 5px;
            border: 1px solid #ccc;
            border-radius: 4px;
            background: #fff;
            cursor: pointer;
            font-size: 0.85em;
            transition: all 0.2s;
        }
        .preset-btn:hover { background: #f0f0f0; border-color: #bbb; }
        
        /* Specific header colors */
        .na-header { color: #27ae60 !important; border-bottom-color: #27ae60 !important; }
        .k-header { color: #2980b9 !important; border-bottom-color: #2980b9 !important; }
        .input-header { color: #e74c3c !important; border-bottom-color: #e74c3c !important; }

        @media (max-width: 768px) {
            .sidebar { width: 100%; height: auto; position: static; }
            main { padding: 20px; margin: 10px; }
            .canvas-wrapper, .controls { flex: 1 1 100%; }
            .explanation-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <header class="logo-header"></header>

    <nav>
        <a href="index.html">Home</a>
        <a href="Projects.html">Current Projects</a>
        <a href="nifti_viewer.html">Interactive MRI Viewer</a>
        <a href="plots.html">Statistics and Plotting</a>
        <a href="neuro_analysis.html">Neuroimaging Analysis Scripts</a>
        <a href="posters.html">Conference Posters</a>
    </nav>

    <div class="sidebar-tab" onclick="toggleSidebar()">☰</div>
    <aside class="sidebar">
        <h3>Quick Links</h3>
        <a href="https://github.com/CohanR/Hodgkin-Huxley_Simulation">Hodgkin Huxley Simulation</a>
        <a href="https://github.com/CohanR/Action_Potential_Simulation">Action Potential Simulation</a>
        <a href="https://github.com/CohanR/TMS_ElectricField_Group_Simulation">TMS Electric Field Simulation</a>
        <a href="https://github.com/CohanR/MotorEvokedPotentials_Propofol_ML">Propofol and MEP ML Algorithm</a>
    </aside>

    <main>
        <h1>Simulation & Machine Learning</h1>
        <p>Below are some of my simulation and ML scripts:</p>

        <section>
            <h2>Interactive Hodgkin-Huxley Lab</h2>
            
            <div class="explanation-grid">
                <div class="exp-col">
                    <h4>The Basics</h4>
                    <ul>
                        <li><strong>Action Potential:</strong> The electrical "spike" when a neuron fires.</li>
                        <li><strong>Depolarization:</strong> Voltage rises sharply. Think of this as the "gas pedal".</li>
                        <li><strong>Hyperpolarization:</strong> Voltage drops below rest. Think of this as the "brake".</li>
                    </ul>
                </div>
                <div class="exp-col">
                    <h4>The Chemistry</h4>
                    <ul>
                        <li><strong>Sodium (Na+):</strong> Positive charge flowing <em>IN</em> causes the spike (Depolarization).</li>
                        <li><strong>Potassium (K+):</strong> Positive charge flowing <em>OUT</em> resets the cell (Hyperpolarization).</li>
                        <li><strong>Resting memberane potential:</strong> -65 mV.</li>
                        <li><small><em> Hodgkin, A. L., & Huxley, A. F. (1952).</em></small></li>
                    </ul>
                </div>
            </div>

            <div class="sim-container">
                <div class="canvas-wrapper">
                    <canvas id="simCanvas" width="600" height="350"></canvas>
                </div>
        
                <div class="controls">
                    <div class="control-group">
                        <h3>Quick Presets</h3>
                        <button class="preset-btn" onclick="applyPreset('normal')">Normal Fire</button>
                        <button class="preset-btn" onclick="applyPreset('low_na')">Low Sodium</button>
                        <button class="preset-btn" onclick="applyPreset('high_k')">High Potassium</button>
                    </div>

                    <div class="control-group">
                        <h3 class="input-header">Stimulation</h3>
                        <div class="slider-container">
                            <span class="slider-label">Current (I)</span>
                            <input type="range" id="i_ext" min="0" max="50" step="0.5" value="10">
                            <span class="slider-value" id="val_i_ext">10.0 µA</span>
                        </div>
                    </div>
        
                    <div class="control-group">
                        <h3 class="na-header">Sodium (Na+)</h3>
                        <div class="slider-container">
                            <span class="slider-label">Conductance</span>
                            <input type="range" id="g_na" min="0" max="250" value="120">
                            <span class="slider-value" id="val_g_na">120 mS</span>
                        </div>
                        <div class="slider-container">
                            <span class="slider-label">Potential (E)</span>
                            <input type="range" id="e_na" min="0" max="100" value="50">
                            <span class="slider-value" id="val_e_na">50 mV</span>
                        </div>
                    </div>
        
                    <div class="control-group">
                        <h3 class="k-header">Potassium (K+)</h3>
                        <div class="slider-container">
                            <span class="slider-label">Conductance</span>
                            <input type="range" id="g_k" min="0" max="100" value="36">
                            <span class="slider-value" id="val_g_k">36 mS</span>
                        </div>
                        <div class="slider-container">
                            <span class="slider-label">Potential (E)</span>
                            <input type="range" id="e_k" min="-100" max="-50" value="-77">
                            <span class="slider-value" id="val_e_k">-77 mV</span>
                        </div>
                    </div>
                    
                    <button onclick="resetDefaults()" style="width:100%; padding:10px; background:#95a5a6; color:white; border:none; border-radius:4px; cursor:pointer; font-size:0.9em; margin-top:10px; font-weight:600;">Reset Simulation</button>
                </div>
            </div>
            
            <p>Get the Python source code here:</p>
            <a href="https://github.com/CohanR/Hodgkin-Huxley_Simulation" target="_blank">View Hodgkin Huxley Simulation Code on GitHub</a>
        </section>

        <hr style="border: 0; height: 1px; background: #ddd; margin: 40px 0;">

        <section>
            <h2>Action Potentials Simulation</h2>
            <img src="images/Action_Potential_Sim_Remy_Cohan.gif" alt="Action Potentials Simulation GIF" style="max-width:100%; height:auto; border-radius:8px;">
            <p>Checkout the Action Potentials Simulation on GitHub:</p>
            <a href="https://github.com/CohanR/Action_Potential_Simulation" target="_blank">View the GitHub Repository</a>
        </section>

        <section>
            <h2>E-Field Simulation</h2>
            <img src="images/e_field_simulation_Remy.png" alt="E-Field Simulation Image" style="max-width:100%; height:auto; border-radius:8px;">
            <p>Explore the Electric Field Simulation on GitHub:</p>
            <a href="https://github.com/CohanR/TMS_ElectricField_Group_Simulation" target="_blank">View the GitHub Repository</a>
        </section>

        <section>
            <h2>Propofol and MEPs ML Model</h2>
            <img src="images/decision_tree_RC.png" alt="Decision Tree Image" style="max-width:100%; height:auto; border-radius:8px;">
            <p>Explore the Machine Learning Algorithm to Predict Whether Handedness and Propofol Dosage have any effects on MEP amplitudes on GitHub:</p>
            <a href="https://github.com/CohanR/MotorEvokedPotentials_Propofol_ML" target="_blank">View the GitHub Repository</a>
        </section>
    </main>

    <script>
        function toggleSidebar() {
            var sidebar = document.querySelector('.sidebar');
            sidebar.style.width = sidebar.style.width === '250px' ? '0' : '250px';
        }

        // --- SIMULATION LOGIC ---
        const params = {
            C_m: 1.0, g_Na: 120.0, E_Na: 50.0,
            g_K: 36.0, E_K: -77.0, g_L: 0.3, E_L: -54.4,
            I_ext: 10.0, dt: 0.05
        };
    
        let state = { V: -65.0, m: 0.05, h: 0.6, n: 0.32, t: 0 };
        const historyLength = 800; 
        let vHistory = new Array(historyLength).fill(-65);
        let iHistory = new Array(historyLength).fill(0);
    
        function runTimeStep() {
            let { V, m, h, n } = state;
            if (isNaN(V) || !isFinite(V) || Math.abs(V) > 500) {
                state.V = -65.0; state.m = 0.05; state.h = 0.6; state.n = 0.32;
                return -65.0; 
            }

            const { g_Na, E_Na, g_K, E_K, g_L, E_L, I_ext, C_m, dt } = params;
            
            const alpha_n = (v) => 0.01 * (v + 55) / (1 - Math.exp(-(v + 55) / 10));
            const beta_n  = (v) => 0.125 * Math.exp(-(v + 65) / 80);
            const alpha_m = (v) => 0.1 * (v + 40) / (1 - Math.exp(-(v + 40) / 10));
            const beta_m  = (v) => 4 * Math.exp(-(v + 65) / 18);
            const alpha_h = (v) => 0.07 * Math.exp(-(v + 65) / 20);
            const beta_h  = (v) => 1 / (1 + Math.exp(-(v + 35) / 10));
    
            const I_Na = g_Na * Math.pow(m, 3) * h * (V - E_Na);
            const I_K  = g_K  * Math.pow(n, 4) * (V - E_K);
            const I_L  = g_L  * (V - E_L);
            const dV = (I_ext - I_Na - I_K - I_L) / C_m;
            
            state.V += dV * dt;
            state.m += (alpha_m(V)*(1-m) - beta_m(V)*m) * dt;
            state.h += (alpha_h(V)*(1-h) - beta_h(V)*h) * dt;
            state.n += (alpha_n(V)*(1-n) - beta_n(V)*n) * dt;
            return state.V;
        }
    
        const canvas = document.getElementById('simCanvas');
        const ctx = canvas.getContext('2d');
        let speedMult = 0.8; // Slow speed
    
        function animate() {
            if(canvas.width !== canvas.offsetWidth) {
                canvas.width = canvas.offsetWidth;
                canvas.height = canvas.offsetHeight;
            }

            for(let i=0; i < speedMult * 5; i++) {
                const newV = runTimeStep();
                vHistory.shift();
                vHistory.push(newV);
                iHistory.shift();
                iHistory.push(params.I_ext);
            }
            draw();
            requestAnimationFrame(animate);
        }
    
        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            const vMin = -90, vMax = 60;
            const yScale = canvas.height / (vMax - vMin);
            
            // Grid
            ctx.strokeStyle = '#eee'; ctx.lineWidth = 1; ctx.beginPath();
            const zeroY = canvas.height - (0 - vMin) * yScale;
            ctx.moveTo(0, zeroY); ctx.lineTo(canvas.width, zeroY);
            const restY = canvas.height - (-65 - vMin) * yScale;
            ctx.strokeStyle = '#ddd'; ctx.setLineDash([5, 5]);
            ctx.moveTo(0, restY); ctx.lineTo(canvas.width, restY);
            ctx.stroke(); ctx.setLineDash([]);
    
            // Traces
            ctx.beginPath(); ctx.strokeStyle = '#e74c3c'; ctx.lineWidth = 2;
            for (let i = 0; i < historyLength; i++) {
                if (isNaN(vHistory[i])) continue;
                const x = (i / historyLength) * canvas.width;
                const y = canvas.height - (vHistory[i] - vMin) * yScale;
                if (i === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y);
            }
            ctx.stroke();
    
            ctx.beginPath(); ctx.strokeStyle = '#3498db'; ctx.lineWidth = 1; ctx.globalAlpha = 0.5;
            for (let i = 0; i < historyLength; i++) {
                const x = (i / historyLength) * canvas.width;
                const y = canvas.height - 10 - (iHistory[i] / 50) * 50; 
                if (i === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y);
            }
            ctx.stroke(); ctx.globalAlpha = 1.0;

            // Labels
            ctx.fillStyle = '#444'; ctx.font = 'bold 12px Poppins, sans-serif';
            ctx.fillText("Voltage (mV)", 10, 20);
            ctx.fillText("Time →", canvas.width - 80, canvas.height - 20);
            ctx.fillStyle = '#999'; ctx.fillText("-65mV", 5, restY - 5);
        }
    
        const inputs = [
            { id: 'i_ext', param: 'I_ext' }, { id: 'g_na', param: 'g_Na' }, { id: 'e_na', param: 'E_Na' },
            { id: 'g_k', param: 'g_K' }, { id: 'e_k', param: 'E_K' }
        ];
    
        function updateUI() {
             inputs.forEach(item => {
                document.getElementById(item.id).value = params[item.param];
                document.getElementById('val_' + item.id).textContent = params[item.param] + (item.param.includes('E') ? ' mV' : (item.param.includes('I') ? ' µA' : ' mS'));
            });
        }

        inputs.forEach(item => {
            document.getElementById(item.id).addEventListener('input', (e) => {
                params[item.param] = parseFloat(e.target.value);
                updateUI();
            });
        });
    
        function applyPreset(type) {
            if(type === 'normal') { params.g_Na=120; params.E_Na=50; params.g_K=36; params.E_K=-77; params.I_ext=10; }
            else if (type === 'low_na') { params.g_Na=30; params.E_Na=50; params.g_K=36; params.E_K=-77; params.I_ext=10; }
            else if (type === 'high_k') { params.g_Na=120; params.E_Na=50; params.g_K=36; params.E_K=-40; params.I_ext=10; }
            state.V = -65.0; updateUI();
        }

        function resetDefaults() {
            params.I_ext=10; params.g_Na=120; params.E_Na=50; params.g_K=36; params.E_K=-77;
            state.V=-65.0; state.m=0.05; state.h=0.6; state.n=0.32;
            vHistory.fill(-65.0); updateUI();
        }

        updateUI(); animate();
    </script>
</body>
</html>

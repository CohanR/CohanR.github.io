<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="canonical" href="https://neuropsis.org/simulations_ml.html">
    <meta name="description" content="Overview of my work in neural data simulation and machine learning.">
    <title>Simulation and Machine Learning | Remy Cohan</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <style>
        /* --- MAIN SITE STYLES --- */
        body {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            padding: 0;
            line-height: 1.7;
            color: #333;
            background: linear-gradient(135deg, #f7f9fc, #dfe6e9);
        }

        header {
            background: #2E86C1;
            color: white;
            text-align: center;
            padding: 2rem 0;
            font-size: 2.5rem;
            font-weight: 600;
            box-shadow: 0px 3px 10px rgba(0, 0, 0, 0.1);
        }

        nav {
            display: flex;
            justify-content: center;
            gap: 20px;
            padding: 10px 0;
            background-color: #333;
            box-shadow: 0px 3px 10px rgba(0, 0, 0, 0.1);
            flex-wrap: wrap;
        }

        nav a {
            color: white;
            text-decoration: none;
            padding: 10px 20px;
            border-radius: 5px;
            transition: background-color 0.3s, transform 0.2s;
        }

        nav a:hover {
            background-color: #555;
            transform: scale(1.05);
        }

        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            height: 100%;
            width: 0; /* Initially set width to 0 */
            overflow: hidden;
            background-color: #34495e;
            padding: 20px 0;
            box-shadow: 2px 0px 5px rgba(0, 0, 0, 0.1);
            transition: width 0.5s ease;
            z-index: 1001; /* Ensure above main content */
        }

        .sidebar:hover,
        .sidebar:focus {
            width: 250px;
        }

        .sidebar h3,
        .sidebar a {
            color: white;
            margin-left: 20px;
            text-decoration: none;
            display: block;
            margin-bottom: 20px;
            transition: color 0.3s;
        }

        .sidebar a:hover {
            color: #bdc3c7;
        }

        .sidebar-tab {
            position: fixed;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            background-color: #34495e;
            color: white;
            padding: 10px;
            border-top-right-radius: 5px;
            border-bottom-right-radius: 5px;
            cursor: pointer;
            z-index: 1000;
            transition: background-color 0.3s;
        }

        main {
            margin-left: 0;
            padding: 40px;
            background-color: #ffffff;
            box-shadow: 0px 3px 15px rgba(0, 0, 0, 0.1);
            border-radius: 10px;
            max-width: 1200px;
            margin: 20px auto;
        }

        /* --- SIMULATION SPECIFIC STYLES --- */
        .sim-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
            width: 100%;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #e1e4e8;
            margin-bottom: 40px;
        }

        .canvas-wrapper {
            background: white;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            position: relative;
        }
        
        canvas {
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: #fff;
            max-width: 100%; /* Responsive canvas */
        }

        .legend {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.9);
            padding: 5px 10px;
            border-radius: 4px;
            border: 1px solid #ccc;
            font-size: 0.8em;
        }
        .legend-item { display: flex; align-items: center; margin-bottom: 2px; }
        .color-box { width: 12px; height: 12px; margin-right: 8px; border-radius: 2px; }

        .controls {
            flex: 1;
            min-width: 300px;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }

        .control-group { margin-bottom: 15px; }
        .control-group h3 { 
            margin: 0 0 10px 0; 
            font-size: 1em; 
            border-bottom: 2px solid #eee; 
            padding-bottom: 5px; 
            color: #555;
        }
        
        .slider-container {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }
        .slider-label { flex: 2; font-size: 0.85em; font-weight: 500;}
        input[type=range] { flex: 3; margin: 0 10px; cursor: pointer; }
        .slider-value { flex: 1; text-align: right; font-family: monospace; font-size: 0.85em; color: #555; }

        .na-header { color: #27ae60 !important; border-bottom-color: #27ae60 !important; }
        .k-header { color: #2980b9 !important; border-bottom-color: #2980b9 !important; }
        .input-header { color: #e74c3c !important; border-bottom-color: #e74c3c !important; }

        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                height: auto;
                position: static;
                transform: none;
            }
            main {
                padding: 20px;
                margin: 10px;
            }
            nav a {
                margin: 5px 0;
            }
        }
    </style>
</head>
<body>
    <header>Remy Cohan</header>

    <nav>
        <a href="index.html">Home</a>
        <a href="Projects.html">Current Projects</a>
        <a href="nifti_viewer.html">Interactive MRI Viewer</a>
        <a href="plots.html">Statistics and Plotting</a>
        <a href="neuro_analysis.html">Neuroimaging Analysis Scripts</a>
        <a href="posters.html">Conference Posters</a>
    </nav>

    <div class="sidebar-tab" onclick="toggleSidebar()">☰</div>

    <aside class="sidebar">
        <h3>Quick Links</h3>
        <a href="https://github.com/CohanR/Hodgkin-Huxley_Simulation">Hodgkin Huxley Simulation</a>
        <a href="https://github.com/CohanR/Action_Potential_Simulation">Action Potential Simulation</a>
        <a href="https://github.com/CohanR/TMS_ElectricField_Group_Simulation">TMS Electric Field Simulation</a>
        <a href="https://github.com/CohanR/MotorEvokedPotentials_Propofol_ML">Propofol and Motor Evoked Potential ML Algorithm</a>
    </aside>

    <main>
        <h1>Simulation & Machine Learning</h1>
        <p>Below are some of my simulation and ML scripts:</p>

        <section>
            <h2>Interactive Hodgkin-Huxley Lab</h2>
            <p><strong>Try it yourself:</strong> Use the sliders below to adjust the ion channel conductance and current stimulation in real-time. Notice how low Sodium (Na+) prevents the spike, or how high Potassium (K+) changes the reset.</p>
            
            <div class="sim-container">
                <div class="canvas-wrapper">
                    <canvas id="simCanvas" width="600" height="350"></canvas>
                    <div class="legend">
                        <div class="legend-item"><div class="color-box" style="background:#e74c3c"></div>Voltage (mV)</div>
                        <div class="legend-item"><div class="color-box" style="background:#3498db"></div>Input Current</div>
                    </div>
                </div>
        
                <div class="controls">
                    
                    <div class="control-group">
                        <h3 class="input-header">Stimulation</h3>
                        <div class="slider-container">
                            <span class="slider-label">Current (I_ext)</span>
                            <input type="range" id="i_ext" min="0" max="50" step="0.5" value="10">
                            <span class="slider-value" id="val_i_ext">10.0 µA</span>
                        </div>
                    </div>
        
                    <div class="control-group">
                        <h3 class="na-header">Sodium (Na+)</h3>
                        <div class="slider-container">
                            <span class="slider-label">Conductance (g)</span>
                            <input type="range" id="g_na" min="0" max="250" value="120">
                            <span class="slider-value" id="val_g_na">120 mS</span>
                        </div>
                        <div class="slider-container">
                            <span class="slider-label">Potential (E)</span>
                            <input type="range" id="e_na" min="0" max="100" value="50">
                            <span class="slider-value" id="val_e_na">50 mV</span>
                        </div>
                    </div>
        
                    <div class="control-group">
                        <h3 class="k-header">Potassium (K+)</h3>
                        <div class="slider-container">
                            <span class="slider-label">Conductance (g)</span>
                            <input type="range" id="g_k" min="0" max="100" value="36">
                            <span class="slider-value" id="val_g_k">36 mS</span>
                        </div>
                        <div class="slider-container">
                            <span class="slider-label">Potential (E)</span>
                            <input type="range" id="e_k" min="-100" max="-50" value="-77">
                            <span class="slider-value" id="val_e_k">-77 mV</span>
                        </div>
                    </div>
                    
                    <button onclick="resetDefaults()" style="width:100%; padding:8px; background:#95a5a6; color:white; border:none; border-radius:4px; cursor:pointer; font-size:0.9em;">Reset to Defaults</button>
                </div>
            </div>
            
            <p>Get the Python source code here:</p>
            <a href="https://github.com/CohanR/Hodgkin-Huxley_Simulation" target="_blank">View Hodgkin Huxley Simulation Code on GitHub</a>
        </section>

        <hr style="border: 0; height: 1px; background: #ddd; margin: 40px 0;">

        <section>
            <h2>Action Potentials Simulation</h2>
            <img src="images/Action_Potential_Sim_Remy_Cohan.gif" alt="Action Potentials Simulation GIF" style="max-width:100%; height:auto; border-radius:8px;">
            <p>Checkout the Action Potentials Simulation on GitHub:</p>
            <a href="https://github.com/CohanR/Action_Potential_Simulation" target="_blank">View the GitHub Repository</a>
        </section>

        <section>
            <h2>E-Field Simulation</h2>
            <img src="images/e_field_simulation_Remy.png" alt="E-Field Simulation Image" style="max-width:100%; height:auto; border-radius:8px;">
            <p>Explore the Electric Field Simulation on GitHub:</p>
            <a href="https://github.com/CohanR/TMS_ElectricField_Group_Simulation" target="_blank">View the GitHub Repository</a>
        </section>

        <section>
            <h2>Propofol and MEPs ML Model</h2>
            <img src="images/decision_tree_RC.png" alt="Decision Tree Image" style="max-width:100%; height:auto; border-radius:8px;">
            <p>Explore the Machine Learning Algorithm to Predict Whether Handedness and Propofol Dosage have any effects on MEP amplitudes on GitHub:</p>
            <a href="https://github.com/CohanR/MotorEvokedPotentials_Propofol_ML" target="_blank">View the GitHub Repository</a>
        </section>
    </main>

    <script>
        function toggleSidebar() {
            var sidebar = document.querySelector('.sidebar');
            sidebar.style.width = sidebar.style.width === '250px' ? '0' : '250px';
        }
    </script>

    <script>
        // --- 1. Physics Constants & State ---
        const params = {
            C_m: 1.0,
            g_Na: 120.0, E_Na: 50.0,
            g_K: 36.0,   E_K: -77.0,
            g_L: 0.3,    E_L: -54.4,
            I_ext: 10.0,
            dt: 0.05
        };
    
        let state = {
            V: -65.0,
            m: 0.05,
            h: 0.6,
            n: 0.32,
            t: 0
        };
    
        // Rolling buffer for plotting
        const historyLength = 800; 
        let vHistory = new Array(historyLength).fill(-65);
        let iHistory = new Array(historyLength).fill(0);
    
        // --- 2. Math Functions (The HH Equations) ---
        function runTimeStep() {
            const { V, m, h, n } = state;
            const { g_Na, E_Na, g_K, E_K, g_L, E_L, I_ext, C_m, dt } = params;
    
            // Helper functions for gating variables
            const alpha_n = (v) => 0.01 * (v + 55) / (1 - Math.exp(-(v + 55) / 10));
            const beta_n  = (v) => 0.125 * Math.exp(-(v + 65) / 80);
            const alpha_m = (v) => 0.1 * (v + 40) / (1 - Math.exp(-(v + 40) / 10));
            const beta_m  = (v) => 4 * Math.exp(-(v + 65) / 18);
            const alpha_h = (v) => 0.07 * Math.exp(-(v + 65) / 20);
            const beta_h  = (v) => 1 / (1 + Math.exp(-(v + 35) / 10));
    
            // Currents
            const I_Na = g_Na * Math.pow(m, 3) * h * (V - E_Na);
            const I_K  = g_K  * Math.pow(n, 4) * (V - E_K);
            const I_L  = g_L  * (V - E_L);
    
            // Derivatives
            const dV = (I_ext - I_Na - I_K - I_L) / C_m;
            const dm = alpha_m(V) * (1 - m) - beta_m(V) * m;
            const dh = alpha_h(V) * (1 - h) - beta_h(V) * h;
            const dn = alpha_n(V) * (1 - n) - beta_n(V) * n;
    
            // Euler Update
            state.V += dV * dt;
            state.m += dm * dt;
            state.h += dh * dt;
            state.n += dn * dt;
            state.t += dt;
    
            return state.V;
        }
    
        // --- 3. Animation Loop ---
        const canvas = document.getElementById('simCanvas');
        const ctx = canvas.getContext('2d');
        let speedMult = 1.5; // Fixed speed multiplier
    
        function animate() {
            // Calculate multiple physics steps per animation frame for smoothness
            for(let i=0; i < speedMult * 5; i++) {
                const newV = runTimeStep();
                
                vHistory.shift();
                vHistory.push(newV);
                
                iHistory.shift();
                iHistory.push(params.I_ext);
            }
            
            draw();
            requestAnimationFrame(animate);
        }
    
        // --- 4. Drawing Logic ---
        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            const vMin = -90;
            const vMax = 60;
            const yScale = canvas.height / (vMax - vMin);
            
            // Draw Grid
            ctx.strokeStyle = '#eee';
            ctx.lineWidth = 1;
            ctx.beginPath();
            const zeroY = canvas.height - (0 - vMin) * yScale;
            ctx.moveTo(0, zeroY); ctx.lineTo(canvas.width, zeroY);
            
            const restY = canvas.height - (-65 - vMin) * yScale;
            ctx.strokeStyle = '#ddd';
            ctx.setLineDash([5, 5]);
            ctx.moveTo(0, restY); ctx.lineTo(canvas.width, restY);
            ctx.stroke();
            ctx.setLineDash([]);
    
            // Draw Voltage Trace
            ctx.beginPath();
            ctx.strokeStyle = '#e74c3c';
            ctx.lineWidth = 2;
            
            for (let i = 0; i < historyLength; i++) {
                const x = (i / historyLength) * canvas.width;
                const y = canvas.height - (vHistory[i] - vMin) * yScale;
                if (i === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            }
            ctx.stroke();
    
            // Draw Input Current Indicator
            ctx.beginPath();
            ctx.strokeStyle = '#3498db';
            ctx.lineWidth = 1;
            ctx.globalAlpha = 0.5;
            for (let i = 0; i < historyLength; i++) {
                const x = (i / historyLength) * canvas.width;
                const normalizedI = (iHistory[i] / 50) * 50; 
                const y = canvas.height - 10 - normalizedI; 
                if (i === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            }
            ctx.stroke();
            ctx.globalAlpha = 1.0;
        }
    
        // --- 5. UI Interactions ---
        const inputs = [
            { id: 'i_ext', param: 'I_ext' },
            { id: 'g_na', param: 'g_Na' },
            { id: 'e_na', param: 'E_Na' },
            { id: 'g_k', param: 'g_K' },
            { id: 'e_k', param: 'E_K' }
        ];
    
        inputs.forEach(item => {
            const el = document.getElementById(item.id);
            const valEl = document.getElementById('val_' + item.id);
            
            el.addEventListener('input', (e) => {
                const val = parseFloat(e.target.value);
                params[item.param] = val;
                valEl.textContent = val + (item.param.includes('E') ? ' mV' : (item.param.includes('I') ? ' µA' : ' mS'));
            });
        });
    
        function resetDefaults() {
            document.getElementById('i_ext').value = 10; params.I_ext = 10;
            document.getElementById('g_na').value = 120; params.g_Na = 120;
            document.getElementById('e_na').value = 50; params.E_Na = 50;
            document.getElementById('g_k').value = 36; params.g_K = 36;
            document.getElementById('e_k').value = -77; params.E_K = -77;
            
            inputs.forEach(item => {
                document.getElementById('val_' + item.id).textContent = params[item.param] + (item.param.includes('E') ? ' mV' : (item.param.includes('I') ? ' µA' : ' mS'));
            });
        }
    
        // Start
        animate();
    </script>
</body>
</html>
